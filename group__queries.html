<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html> <head>
     <title>Apophenia: a library for scientific computing</title>

<!-- Google is watching. -->
<script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-134313-2";
urchinTracker();
</script>


     <link rel="stylesheet" href="typical.css" type="text/css" >
     <script  type="text/javascript" language="JavaScript" src="tree.js"></script>
</head><body>
     <center><table cellpadding=10pt>
     <tr> <td><img width=140px src=flake.gif alt="Patterns in static"></td> 
    <td><table>
     	<tr> <td><center><h2><a href="http://apophenia.info">Apophenia</a></h2></center></td></tr>
<tr><td><div class="qindex"><a class="qindex" href="index.html">&nbsp;Intro</a> | <a class="qindex" href="outline.html">Outline</a> | <a class="qindex" href="globals.html">Index</a> <!--| <a class="qindex" href="files.html">File&nbsp;List&nbsp;</a> -->  </div></td></tr></table>
	</td></tr></table></center>

    <div> <!--Doxygen generates an extra </div>.-->
<!-- Generated by Doxygen 1.7.6.1 -->
</div>
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">Queries</div>  </div>
</div><!--header-->
<div class="contents">
<h2><a name="func-members"></a>
Functions</h2>
<ul>
<li>int <a class="el" href="group__queries.html#ga236452b3305ea7b791c781d91a819e3b">apop_query</a> (const char *fmt,...)
<li><a class="el" href="structapop__data.html">apop_data</a> * <a class="el" href="group__queries.html#ga2fbd580cd71f481ae04ee03b5cf64ff5">apop_query_to_text</a> (const char *fmt,...)
<li><a class="el" href="structapop__data.html">apop_data</a> * <a class="el" href="group__queries.html#gade862993166c6482f53562fb77721db9">apop_query_to_data</a> (const char *fmt,...)
<li>gsl_matrix * <a class="el" href="group__queries.html#ga8a1da4d925dbafdd2b3318672eac751f">apop_query_to_matrix</a> (const char *fmt,...)
<li>gsl_vector * <a class="el" href="group__queries.html#ga830703db838855b8abd636069c7145de">apop_query_to_vector</a> (const char *fmt,...)
<li>double <a class="el" href="group__queries.html#ga1ad75f9dfba696a3741e28896ed5b75d">apop_query_to_float</a> (const char *fmt,...)
<li><a class="el" href="structapop__data.html">apop_data</a> * <a class="el" href="group__queries.html#ga1f06db34e05b5afb63112f83ad2317b8">apop_query_to_mixed_data</a> (const char *typelist, const char *fmt,...)
</ul>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<p>These functions query the database, and most return a value for use on the C-side.</p>
<p>In all cases, your query may be in <code>printf</code> form. For example: </p>
<div class="fragment"><pre class="fragment"><span class="keywordtype">char</span> tabname[] = <span class="stringliteral">&quot;demographics&quot;</span>;
<span class="keywordtype">char</span> colname[] = <span class="stringliteral">&quot;heights&quot;</span>;
<span class="keywordtype">int</span> min_height = 175;
<a class="code" href="group__queries.html#ga236452b3305ea7b791c781d91a819e3b">apop_query</a>(<span class="stringliteral">&quot;select %s from %s where %s &gt; %i&quot;</span>, colname, tabname, colname, min_height);
</pre></div><ul>
<li>Blanks in the database (i.e., <code> NULL</code>s) and elements that match <a class="el" href="structapop__opts__type.html">apop_opts.db_nan</a> are filled with <code>NAN</code>s in the matrix. </li>
</ul>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="ga236452b3305ea7b791c781d91a819e3b"></a><!-- doxytag: member="apop_db.c::apop_query" ref="ga236452b3305ea7b791c781d91a819e3b" args="(const char *fmt,...)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="group__queries.html#ga236452b3305ea7b791c781d91a819e3b">apop_query</a> </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>fmt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>...</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Send a query to the database that returns no data.</p>
<ul>
<li>As with the <code>apop_query_to_</code>... functions, the query can include printf-style format specifiers, such as <code>apop_query("create table %s(id, name, age);", tablename)</code>.</li>
</ul>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">fmt</td><td>A <code>printf</code>-style SQL query. </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>0 on success, 1 on failure. </dd></dl>

</div>
</div>
<a class="anchor" id="gade862993166c6482f53562fb77721db9"></a><!-- doxytag: member="apop_db.c::apop_query_to_data" ref="gade862993166c6482f53562fb77721db9" args="(const char *fmt,...)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structapop__data.html">apop_data</a>* <a class="el" href="group__queries.html#gade862993166c6482f53562fb77721db9">apop_query_to_data</a> </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>fmt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>...</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Queries the database, and dumps the result into an <a class="el" href="gentle.html#apop_data">apop_data</a> set.</p>
<ul>
<li>If <a class="el" href="structapop__opts__type.html">apop_opts.db_name_column</a> is set (it defaults to being "row_names"), and the name of a column matches the name, then the row names are read from that column.</li>
</ul>
<ul>
<li>As with the other <code>apop_query_to_</code>... functions, the query can include printf-style format specifiers, such as <code>apop_query_to_data("select age from %s where id=%i;", tablename, id_number)</code>.</li>
</ul>
<dl class="return"><dt><b>Returns:</b></dt><dd>If no rows are returned, <code>NULL</code>; else an <a class="el" href="gentle.html#apop_data">apop_data</a> set with the data in place. Most data will be in the <code>matrix</code> element of the output. Column names are appropriately placed. If <code>apop_opts.db_name_column</code> matches one of the fields in your query's output, then that column will be used for row names (and therefore will not appear in the <code>matrix</code>).</dd></dl>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">fmt</td><td>A <code>printf</code>-style SQL query. </td></tr>
  </table>
  </dd>
</dl>
<dl class="exception"><dt><b>Exceptions:</b></dt><dd>
  <table class="exception">
    <tr><td class="paramname">out-&gt;error=='q'</td><td>Query error. A valid query that returns no rows is not an error; in that case, you get <code>NULL</code>. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ga1ad75f9dfba696a3741e28896ed5b75d"></a><!-- doxytag: member="apop_db.c::apop_query_to_float" ref="ga1ad75f9dfba696a3741e28896ed5b75d" args="(const char *fmt,...)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double <a class="el" href="group__queries.html#ga1ad75f9dfba696a3741e28896ed5b75d">apop_query_to_float</a> </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>fmt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>...</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Queries the database, and dumps the result into a single double-precision floating point number.</p>
<ul>
<li>This calls <a class="el" href="group__queries.html#gade862993166c6482f53562fb77721db9">apop_query_to_data</a> and returns the (0,0)th element of the returned matrix. Thus, if your query returns multiple lines, you will get no warning, and the function will return the first in the list (which is not always well-defined; maybe use an <code>order by</code> clause in your query if you expect multiple lines).</li>
</ul>
<ul>
<li>If <code>apop_opts.db_name_column</code> is set, then I'll ignore that column. It gets put into the names of the <a class="el" href="gentle.html#apop_data">apop_data</a> set, and then thrown away when I look at only the <code>gsl_matrix</code> element of that set.</li>
</ul>
<ul>
<li>If the query returns no rows at all, the function returns <code>NAN</code>.</li>
</ul>
<ul>
<li>If the query produces a blank table, returns <code>NAN</code>, and if <code>apop_opts.verbose&gt;=2</code>, prints an error.</li>
</ul>
<ul>
<li>As with the other <code>apop_query_to_</code>... functions, the query can include printf-style format specifiers, such as <code>apop_query_to_float("select age from %s where id=%i;", tablename, id_number)</code>.</li>
</ul>
<ul>
<li>If the query produces an error, returns <code>NAN</code>, and if <code>apop_opts.verbose&gt;=0</code>, prints an error. If you need to distinguish between blank tables, NaNs in the data, and query errors, use <a class="el" href="group__queries.html#gade862993166c6482f53562fb77721db9">apop_query_to_data</a>.</li>
</ul>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">fmt</td><td>A <code>printf</code>-style SQL query. </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>A <code>double</code>, actually. </dd></dl>

</div>
</div>
<a class="anchor" id="ga8a1da4d925dbafdd2b3318672eac751f"></a><!-- doxytag: member="apop_db.c::apop_query_to_matrix" ref="ga8a1da4d925dbafdd2b3318672eac751f" args="(const char *fmt,...)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">gsl_matrix* <a class="el" href="group__queries.html#ga8a1da4d925dbafdd2b3318672eac751f">apop_query_to_matrix</a> </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>fmt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>...</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Queries the database, and dumps the result into a matrix.</p>
<p>Uses <a class="el" href="group__queries.html#gade862993166c6482f53562fb77721db9">apop_query_to_data</a> and returns just the matrix part; see that function for notes.</p>
<ul>
<li>If <code>apop_opts.db_name_column</code> is set, then I'll ignore that column. It gets put into the names of the <a class="el" href="gentle.html#apop_data">apop_data</a> set, and then thrown away when I return only the <code>gsl_matrix</code> part of that set.</li>
</ul>
<ul>
<li>As with the other <code>apop_query_to_</code>... functions, the query can include printf-style format specifiers, such as <code>apop_query_to_matrix("select age from %s where id=%i;", tablename, id_number)</code>.</li>
</ul>
<dl class="deprecated"><dt><b><a class="el" href="deprecated.html#_deprecated000001">Deprecated:</a></b></dt><dd>Use <a class="el" href="group__queries.html#gade862993166c6482f53562fb77721db9">apop_query_to_data</a> </dd></dl>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">fmt</td><td>A <code>printf</code>-style SQL query. </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>A <code>gsl_matrix</code>. </dd></dl>
<dl class="exception"><dt><b>Exceptions:</b></dt><dd>
  <table class="exception">
    <tr><td class="paramname">out-&gt;error=='q'</td><td>Query error. A valid query that returns no rows is not an error; in that case, you get <code>NULL</code>. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ga1f06db34e05b5afb63112f83ad2317b8"></a><!-- doxytag: member="apop_db.c::apop_query_to_mixed_data" ref="ga1f06db34e05b5afb63112f83ad2317b8" args="(const char *typelist, const char *fmt,...)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structapop__data.html">apop_data</a>* <a class="el" href="group__queries.html#ga1f06db34e05b5afb63112f83ad2317b8">apop_query_to_mixed_data</a> </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>typelist</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>fmt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>...</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Query data to an <code><a class="el" href="structapop__data.html">apop_data</a></code> set, but a mix of names, vectors, matrix elements, and text.</p>
<p>If you are querying to a matrix and maybe a name, use <code>apop_query_to_data</code> (and set <a class="el" href="structapop__opts__type.html">apop_opts.db_name_column</a> if desired). But if your data is a mix of text and numbers, use this.</p>
<p>The first argument is a character string consisting of the letters <code>nvmtw</code>, one for each column of the SQL output, indicating whether the column is a name, vector, matrix column, text column, or weight vector. You can have only one n, v, and w.</p>
<p>If the query produces more columns than there are elements in the column specification, then the remainder are dumped into the text section. If there are fewer columns produced than given in the spec, the additional elements will be allocated but not filled (i.e., they are uninitialized and will have garbage).</p>
<p>The 'n' character indicates row, meaning that <a class="el" href="structapop__opts__type.html">apop_opts.db_name_column</a> is ignored).</p>
<ul>
<li>As with the other <code>apop_query_to_</code>... functions, the query can include printf-style format specifiers, such as <code>apop_query_to_mixed_data("tv", "select name, age from %s where id=%i", tablename, id_number)</code>.</li>
</ul>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">fmt</td><td>A <code>printf</code>-style SQL query. </td></tr>
  </table>
  </dd>
</dl>
<dl class="exception"><dt><b>Exceptions:</b></dt><dd>
  <table class="exception">
    <tr><td class="paramname">out-&gt;error=='d'</td><td>Dimension error. Your count of matrix parts didn't match what the query returned. </td></tr>
    <tr><td class="paramname">out-&gt;error=='q'</td><td>Query error. A valid query that returns no rows is not an error; in that case, you get <code>NULL</code>. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ga2fbd580cd71f481ae04ee03b5cf64ff5"></a><!-- doxytag: member="apop_db.c::apop_query_to_text" ref="ga2fbd580cd71f481ae04ee03b5cf64ff5" args="(const char *fmt,...)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structapop__data.html">apop_data</a>* <a class="el" href="group__queries.html#ga2fbd580cd71f481ae04ee03b5cf64ff5">apop_query_to_text</a> </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>fmt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>...</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Dump the results of a query into an array of strings.</p>
<dl class="return"><dt><b>Returns:</b></dt><dd>An <a class="el" href="gentle.html#apop_data">apop_data</a> structure with the <code>text</code> element filled.</dd></dl>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">fmt</td><td>A <code>printf</code>-style SQL query.</td></tr>
  </table>
  </dd>
</dl>
<ul>
<li>If <code>apop_opts.db_name_column</code> matches a column of the output table, then that column is used for row names, and therefore will not be included in the <code>text</code>.</li>
</ul>
<ul>
<li><code>query_output-&gt;text</code> is always a 2-D array of strings, even if the query returns a single column. In that case, use <code>returned_tab-&gt;text[i][0]</code> (or equivalently, <code>*returned_tab-&gt;text[i]</code>) to refer to row <code>i</code>.</li>
</ul>
<ul>
<li>If an element in the database is <code>NULL</code>, the corresponding cell in the output table will be filled with the text given by <code>apop_opts.db_nan</code>. The default is <code>"NaN"</code>, but you can use <code>sprintf(apop_opts.db_nan, "whatever you like")</code> to change the text to whatever you like.</li>
</ul>
<ul>
<li>Returns <code>NULL</code> if your query is valid but returns zero rows.</li>
</ul>
<ul>
<li>As with the other <code>apop_query_to_</code>... functions, the query can include printf-style format specifiers, such as <code>apop_query_to_text("select name from %s where id=%i;", tablename, id_number)</code>.</li>
</ul>
<p>For example, the following function will list the tables in an SQLite database (much like you could do from the command line using <code>sqlite3 dbname.db ".table"</code>).</p>
<dl class="exception"><dt><b>Exceptions:</b></dt><dd>
  <table class="exception">
    <tr><td class="paramname">out-&gt;error='q'</td><td>The database engine was unable to run the query (e.g., invalid SQL syntax). Again, a valid query that returns zero rows is not an error, and <code>NULL</code> is returned. <div class="fragment"><pre class="fragment"><span class="preprocessor">#include &lt;apop.h&gt;</span>

<span class="keywordtype">void</span> print_table_list(<span class="keywordtype">char</span> *db_file){
    <a class="code" href="apop__db_8c.html#a4d81aff912df2982697038c51795e358">apop_db_open</a>(db_file);
    <a class="code" href="structapop__data.html">apop_data</a> *tab_list= <a class="code" href="group__queries.html#ga2fbd580cd71f481ae04ee03b5cf64ff5">apop_query_to_text</a>(<span class="stringliteral">&quot;select name &quot;</span>
                    <span class="stringliteral">&quot;from sqlite_master where type==&#39;table&#39;&quot;</span>);
    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt; tab_list-&gt;textsize[0]; i++)
        printf(<span class="stringliteral">&quot;%s\n&quot;</span>, tab_list-&gt;text[i][0]);
}

<span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv){
    <span class="keywordflow">if</span> (argc == 1){
        printf(<span class="stringliteral">&quot;Give me a database name, and I will print out &quot;</span>
               <span class="stringliteral">&quot;the list of tables contained therein.\n&quot;</span>);
        <span class="keywordflow">return</span> 0; 
    }
    print_table_list(argv[1]);
}
</pre></div> </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ga830703db838855b8abd636069c7145de"></a><!-- doxytag: member="apop_db.c::apop_query_to_vector" ref="ga830703db838855b8abd636069c7145de" args="(const char *fmt,...)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">gsl_vector* <a class="el" href="group__queries.html#ga830703db838855b8abd636069c7145de">apop_query_to_vector</a> </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>fmt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>...</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Queries the database, and dumps the first column of the result into a <code>gsl_vector</code>.</p>
<ul>
<li>Uses <a class="el" href="group__queries.html#gade862993166c6482f53562fb77721db9">apop_query_to_data</a> internally, then throws away all but the first column of the matrix.</li>
</ul>
<ul>
<li>If <code>apop_opts.db_name_column</code> is set, then I'll ignore that column. It gets put into the names of the <a class="el" href="gentle.html#apop_data">apop_data</a> set, and then thrown away when I look at only the <code>gsl_matrix</code> part of that set.</li>
</ul>
<ul>
<li>If the query returns zero rows of data or no columns, the function returns <code>NULL</code>.</li>
</ul>
<ul>
<li>As with the other <code>apop_query_to_</code>... functions, the query can include printf-style format specifiers, such as <code>apop_query_to_vector("select age from %s where id=%i;", tablename, id_number)</code>.</li>
</ul>
<dl class="return"><dt><b>Returns:</b></dt><dd>A <code>gsl_vector</code> holding the first column of the returned matrix. Thus, if your query returns multiple lines, you will get no warning, and the function will return the first in the list.</dd></dl>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">fmt</td><td>A <code>printf</code>-style SQL query. </td></tr>
  </table>
  </dd>
</dl>
<dl class="exception"><dt><b>Exceptions:</b></dt><dd>
  <table class="exception">
    <tr><td class="paramname">out-&gt;error=='q'</td><td>Query error. A valid query that returns no rows is not an error; in that case, you get <code>NULL</code>. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->
<p><p>
<div class="tiny">Autogenerated by doxygen on Fri May 17 2013.</div></body></html>
